<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>Production Order : {{order.no}} | Production Part Traker</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CCS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CCS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->

    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            Production Order : {{order.no}}
          </ol>
          <div class="c-subheader-nav d-md-down-none mfe-2">

          </div>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <!-- Main Body -->
              <div class="row">
                  <!-- Left Content -->
                  <div class="col-sm-12 col-md-4">
                    <!-- Production Order Information -->
                    <div class="card border-secondary">
                      <div class="card-header">
                        <strong>Production Order Information</strong>
                      </div>
                      <div class="card-body">
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right">Production Order No</label>
                          <div class="col-md-8">
                            <input class="form-control" type="text" maxlength="10" id="order_no" value="{{order.no}}" disabled>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right">Drawing No</label>
                          <div class="col-md-8">
                            <input class="form-control" type="text" id="drawing_no" value="{{order.drawing_no}}" disabled>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right">FG Code</label>
                          <div class="col-md-8">
                            <input class="form-control" type="text" id="fg_code" value="{{order.fg_code}}" disabled>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right">Creator</label>
                          <div class="col-md-8">
                            <input class="form-control" type="text" id="emp_id" value="{{order.emp_id}}" disabled>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Content -->
                  <div class="col-sm-12 col-md-8">
                    <!-- Button Group -->
                    <div class="col-md-12 text-right">
                      <button type="button" class="btn btn-lg btn-dark small" style="width: 80px" data-toggle="modal" data-target="#print_all_modal"><i class="c-icon c-icon-xl cil-qr-code"></i><br>Print All</button>
                      <button type="button" class="btn btn-lg btn-success small" style="width: 80px" data-toggle="modal" data-target="#create_serial_code_modal"><i class="c-icon c-icon-xl cil-plus"></i><br>Create</button>
                      <button type="button" class="btn btn-lg btn-primary small" style="width: 80px" data-toggle="modal" data-target="#multiple_receive_modal"><i class="c-icon c-icon-xl cil-chevron-double-right"></i><br>Multiple</button>
                      <p></p>
                    </div>
                    <!-- Serial Code List -->
                    <div class="card border-secondary">
                      <div class="card-header">
                        <strong>Serial Code List ({{serial_codes|length}})</strong>
                      </div>
                      <div class="card-body">
                        <input type="text" id="serial_code_count" value="{{serial_codes|length}}" hidden>
                        <table class="table table-sm text-center" id="serial_code_table">
                          <thead>
                            <tr class="bg-dark">
                              <th>Item</th>
                              <th>Serial Code</th>
                              <th></th>
                              <th>Status</th>
                              <th>Employee</th>
                              <th>Location</th>
                              <th>Timestamp</th>
                              <th></th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for serial_code in serial_codes %}
                            <tr>
                              <td>{{forloop.counter}}</td>
                              <td>{{serial_code.code}}</td>
                              <td><button type="button" class="btn btn-sm btn-link small" style="padding-top:0px; padding-bottom:0px;" data-toggle="modal" data-target="#qrcode_modal" onclick="prepare_qrcode('{{serial_code.code}}')"><i class="c-icon cil-qr-code"></i></button></td>
                              <td>
                                {% if last_status|index:forloop.counter0 == 'CREATED' %}<span class="text-success">Created</span>
                                {% elif last_status|index:forloop.counter0 == 'RECEIVED' %}<span class="text-info">Received</span>
                                {% elif last_status|index:forloop.counter0 == 'REJECTED' %}<span class="text-danger">Rejected</span>
                                {% else %}{{last_status|index:forloop.counter0}}{% endif %}
                              </td>
                              <td>{{last_receivers|index:forloop.counter0}}</td>
                              <td>{{last_locations|index:forloop.counter0}}</td>
                              <td>{{last_timestamps|index:forloop.counter0}}</td>
                              <td class="text-left">
                                <button type="button" class="btn btn-sm btn-pill btn-info small" data-toggle="modal" data-target="#path_{{serial_code.id}}_modal">Path</button>
                                {% if last_status|index:forloop.counter0 != 'REJECTED' %}
                                <button type="button" class="btn btn-sm btn-pill btn-primary small" data-toggle="modal" data-target="#receive_modal" onclick="prepare_receive('{{serial_code.id}}','{{serial_code.code}}')">Receive</button>
                                <button type="button" class="btn btn-sm btn-pill btn-danger small" data-toggle="modal" data-target="#reject_modal" onclick="prepare_reject('{{serial_code.id}}','{{serial_code.code}}')">Reject</button>
                                {% endif %}
                                {% if last_status|index:forloop.counter0 == 'CREATED' %}
                                <button type="button" class="btn btn-sm btn-pill btn-warning small" data-toggle="modal" data-target="#edit_modal" onclick="prepare_edit('{{serial_code.id}}','{{serial_code.code}}')">Edit</button>
                                {% endif %}
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}
      <!-- *** MODAL *** -->
      <!-- Path Modal -->
      {% for serial_code in serial_codes %}
      <div class="modal fade" id="path_{{serial_code.id}}_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-info" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Path : {{serial_code.code}}</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <table class="table table-sm text-center" id="path_{{serial_code.id}}_table">
                <thead>
                  <tr class="bg-dark">
                    <th>No</th>
                    <th>Status</th>
                    <th>Employee</th>
                    <th>Location</th>
                    <th>Timestamp</th>
                  </tr>
                </thead>
                <tbody>
                  {% for path in path_list|index:forloop.counter0 %}
                  <tr>
                    <td>{{forloop.counter}}</td>
                    <td>
                      {% if path.status == 'CREATED' %}<span class="text-success">Created</span>
                      {% elif path.status == 'RECEIVED' %}<span class="text-info">Received</span>
                      {% elif path.status == 'REJECTED' %}<span class="text-danger">Rejected</span>
                      {% else %}ERROR{% endif %}
                    </td>
                    <td>{{path.emp_id}}</td>
                    <td>{{path.location}}</td>
                    <td>{{path.date_published}}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
      <!-- Create Serial Code Modal -->
      <div class="modal fade" id="create_serial_code_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-success" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Create</span></h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body text-center">
              <input class="form-control" type="text" maxlength="10" id="create_serial_code_id" hidden>
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Serial Code</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="create_serial_code" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Employee ID</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="create_emp_id" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Location</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="create_location" value="">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-success" type="button" onclick="create()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Multiple Receive Modal -->
      <div class="modal fade" id="multiple_receive_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Multiple Receive</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body text-center">
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Serial Code(s)</label>
                <div class="col-md-8">
                  <select class="c-multi-select text-left" id="multiple_receive_serial_code_list" multiple>
                    {% for serial_code in serial_codes %}
                    {% if last_status|index:forloop.counter0 != 'REJECTED' %}
                    <option value="{{serial_code.id}}">{{serial_code.code}}</option>
                    {% endif %}
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Employee ID</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="multiple_receive_emp_id" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Location</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="multiple_receive_location" value="">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" onclick="multiple_receive()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Receive Modal -->
      <div class="modal fade" id="receive_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Receive : <span id="receive_serial_code"></span></h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body text-center">
              <input class="form-control" type="text" maxlength="10" id="receive_serial_code_id" hidden>
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Employee ID</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="receive_emp_id" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Location</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="receive_location" value="">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" onclick="receive()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Reject Modal -->
      <div class="modal fade" id="reject_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Reject : <span id="reject_serial_code"></span></h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body text-center">
              <input class="form-control" type="text" maxlength="10" id="reject_serial_code_id" hidden>
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Employee ID</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="reject_emp_id" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">Location</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="reject_location" value="">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-danger" type="button" onclick="reject()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Edit Modal -->
      <div class="modal fade" id="edit_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-warning" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Edit : <span id="edit_serial_code"></span></h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body text-center">
              <input class="form-control" type="text" maxlength="10" id="edit_serial_code_id" hidden>
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right">New Serial Code</label>
                <div class="col-md-8">
                  <input class="form-control" type="text" id="new_serial_code" value="">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-warning" type="button" onclick="edit()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- QR Code Modal -->
      <div class="modal fade" id="qrcode_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dark" role="document" style="width: 310px;">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">QR Code</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body" id="qrcode_section">
              <div>
                <div id="qrcode" style="padding-top:3px; padding-left:10px; width:75px; height:75px; display: inline-block;"></div>
                <div style="padding-left:15px; display: inline-block; justify-content: center; color:#000; font-weight: 1000;">{{order.no}}<br><span id="qrcode_serial_code"></span><br>&nbsp;</div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-dark" type="button" onclick="print_qrcode('#qrcode_section')">Print</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Print All Modal -->
      <div class="modal fade" id="print_all_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dark" role="document" style="width: 310px;">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Print All QR Code</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body" id="print_all_section">
              <div style="margin-bottom:102px"></div>
              {% for serial_code in serial_codes %}
              <div>
                <div id="qrcode_{{forloop.counter0}}" style="padding-top:5px; padding-left:10px; width:75px; height:75px; display: inline-block;"></div>
                <div style="padding-left:15px; display: inline-block; justify-content: center; color:#000; font-weight: 1000;">{{order.no}}<br><span id="qrcode_serial_code_{{forloop.counter0}}">{{serial_code.code}}</span><br>&nbsp;</div>
              </div>
              <div style="margin-bottom:{% if forloop.counter0|divisibleby:2 %}33px{% else %}32px{% endif %}"></div>
              {% endfor %}
            </div>
            <div class="modal-footer">
              <button class="btn btn-dark" type="button" onclick="print_qrcode('#print_all_section')">Print</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <!-- Jqeury JS -->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <!-- Select JS -->
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Datamask JS -->
    <script src="{% static "vendors/jquery.maskedinput/js/jquery.maskedinput.js" %}"></script>
    <!-- Barcode JS -->
    <script src="{% static "vendors/jsbarcode/js/jsbarcode.all.min.js" %}"></script>
    <!-- QRcode JS -->
    <script src="{% static "vendors/qrcode/js/qrcode.min.js" %}"></script>
    <!-- Custom JS -->
    <script src="{% static "vendors/html2canvas/js/html2canvas.min.js" %}"></script>
    <!-- Custom JS -->
    <script src="{% static "customize/js/clock.js" %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });
      var multiple_receive_serial_code_list = document.getElementById('multiple_receive_serial_code_list');
      var multiple_receive_serial_code_select = new coreui.MultiSelect(multiple_receive_serial_code_list, {
        multiple: true,
        selectionType: 'tags',
        search: true,
      });

      var qrcode = new QRCode(document.getElementById("qrcode"), {
      	text: "0000000000-0000000-00-00-0000",
      	width: 75,
      	height: 75,
      });

      prepare_print_all();

      //-- INITAILIZE
      $(document).ready(function() {
        showTime();
        $('#new_serial_code').mask('9999999-99-99-9999');
        $('#create_serial_code').mask('9999999-99-99-9999');
      });

      //-- MAIN FUNCTION
      function prepare_print_all(){
        var order_no = $('#order_no').val();
        var serial_code_count = $('#serial_code_count').val();
        for(var i = 0;i < serial_code_count;i++){
          var serial_code = $('#qrcode_serial_code_' + i).text();
          new QRCode(document.getElementById("qrcode_" + i), {
          	text: (order_no + "-" + serial_code),
          	width: 75,
          	height: 75,
          });
        }
      }

      function prepare_qrcode(code){
        var order_no = $('#order_no').val();
        $('#qrcode_serial_code').text(code);
        if(qrcode != null) qrcode.clear();
        qrcode.makeCode(order_no + "-" + code);
      }

      function print_qrcode(section){
       $("#qrcode_modal .close").click();
       $("#print_all_modal .close").click();
       html2canvas(document.querySelector(section)).then(canvas => {
         var printWindow = window.open('', '', 'height=600,width=800');
         printWindow.document.write('<html><head><title>Print QR Code</title>');
         printWindow.document.write('</head><body>');
         printWindow.document.body.appendChild(canvas);
         printWindow.document.write('</body></html>');
         printWindow.document.close();
         printWindow.print();
       });
      }

      function multiple_receive(){
        var order_no = $('#order_no').val();
        var serial_code_list = $('#multiple_receive_serial_code_list').val();
        var emp_id = $('#multiple_receive_emp_id').val();
        var location = $('#multiple_receive_location').val();
        if(serial_code_list.length == 0){
          return;
        } else if(emp_id == ""){
          invalid('multiple_receive_emp_id');
          return;
        } else if (location == ""){
          valid('multiple_receive_emp_id');
          invalid('multiple_receive_location');
          return;
        } else {
          valid('multiple_receive_emp_id');
          valid('multiple_receive_location');
          $.ajax({
            url: '/multiple_receive/',
            data: {
              'serial_code_list' : serial_code_list,
              'emp_id' : emp_id,
              'location' : location,
            },
            dataType: 'json',
            success: function (data) {
              window.location.replace("/order/" + order_no);
            }
          });
        }
      }

      function create(){
        var order_no = $('#order_no').val();
        var serial_code = $('#create_serial_code').val();
        var emp_id = $('#create_emp_id').val();
        var location = $('#create_location').val();
        if(serial_code.length != 18){
          invalid('create_serial_code');
          return;
        }
        validate_serial_code(serial_code, function(result) {
          if(!result){
            invalid('create_serial_code');
            return;
          } else if(emp_id == ""){
            valid('create_serial_code');
            invalid('create_emp_id');
            return;
          } else if (location == ""){
            valid('create_serial_code');
            valid('create_emp_id');
            invalid('create_location');
            return;
          } else {
            valid('create_serial_code');
            valid('create_emp_id');
            valid('create_location');
            $.ajax({
              url: '/create_serial/',
              data: {
                'order_no' : order_no,
                'serial_code' : serial_code,
                'emp_id' : emp_id,
                'location' : location,
              },
              dataType: 'json',
              success: function (data) {
                window.location.replace("/order/" + order_no);
              }
            });
          }
        });
      }

      function prepare_receive(id, code){
        $('#receive_serial_code').text(code);
        $('#receive_serial_code_id').val(id);
      }

      function receive(){
        var order_no = $('#order_no').val();
        var serial_code_id = $('#receive_serial_code_id').val();
        var emp_id = $('#receive_emp_id').val();
        var location = $('#receive_location').val();
        if(emp_id == ""){
          invalid('receive_emp_id');
          return;
        } else if (location == ""){
          valid('receive_emp_id');
          invalid('receive_location');
          return;
        } else {
          valid('receive_emp_id');
          valid('receive_location');
          $.ajax({
            url: '/serial_receive/',
            data: {
              'serial_code_id' : serial_code_id,
              'emp_id' : emp_id,
              'location' : location,
            },
            dataType: 'json',
            success: function (data) {
              window.location.replace("/order/" + order_no);
            }
          });
        }
      }

      function prepare_reject(id, code){
        $('#reject_serial_code').text(code);
        $('#reject_serial_code_id').val(id);
      }

      function reject(){
        var order_no = $('#order_no').val();
        var serial_code_id = $('#reject_serial_code_id').val();
        var emp_id = $('#reject_emp_id').val();
        var location = $('#reject_location').val();
        if(emp_id == ""){
          invalid('reject_emp_id');
          return;
        } else if (location == ""){
          valid('reject_emp_id');
          invalid('reject_location');
          return;
        } else {
          valid('reject_emp_id');
          valid('reject_location');
          $.ajax({
            url: '/serial_reject/',
            data: {
              'serial_code_id' : serial_code_id,
              'emp_id' : emp_id,
              'location' : location,
            },
            dataType: 'json',
            success: function (data) {
              window.location.replace("/order/" + order_no);
            }
          });
        }
      }

      function prepare_edit(id, code){
        $('#edit_serial_code').text(code);
        $('#edit_serial_code_id').val(id);
      }

      function edit(){
        var order_no = $('#order_no').val();
        var serial_code_id = $('#edit_serial_code_id').val();
        var new_serial_code = $('#new_serial_code').val();
        if(new_serial_code.length != 18){
          invalid('new_serial_code');
          return;
        } else {
          validate_serial_code(new_serial_code, function(result) {
            if(!result){
              invalid('new_serial_code');
              return;
            } else {
              valid('new_serial_code');
              $.ajax({
                url: '/serial_edit/',
                data: {
                  'serial_code_id' : serial_code_id,
                  'new_serial_code' : new_serial_code,
                },
                dataType: 'json',
                success: function (data) {
                  window.location.replace("/order/" + order_no);
                }
              });
            }
          });
        }
      }

      function validate_serial_code(serial_code, _callback){
        var order_no = $('#order_no').val();
        $.ajax({
          url: '/validate_serial_code/',
          data: {
            'order_no': order_no,
            'serial_code': serial_code,
          },
          dataType: 'json',
          success: function (data) {
            if (data.is_exist) {
              _callback(false);
              return;
            } else {
              _callback(true);
              return;
            }
          }
        });
      }

      //-- VALIDATE CONTROL
      function valid(box_id){
        $("#" + box_id).addClass("is-valid");
        $("#" + box_id).removeClass("is-invalid");
      }

      function invalid(box_id){
        $("#" + box_id).addClass("is-invalid");
        $("#" + box_id).removeClass("is-valid");
      }

      function invalid_text(text){
        $('#invalid-icon').prop('hidden', false);
        $('#invalid-text').text(text);
      }
    </script>
  </body>
</html>
